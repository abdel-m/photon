<script lang="ts">
  import { page } from '$app/stores'
  import {
    GlobeAmericas,
    Icon,
    InformationCircle,
    MagnifyingGlass,
    QuestionMarkCircle,
  } from 'svelte-hero-icons'
  import Pageination from '$lib/components/ui/Pageination.svelte'
  import { searchParam } from '$lib/util.js'
  import { Button, Material, Popover, Select, TextInput } from 'mono-svelte'
  import Sort from '$lib/components/lemmy/dropdowns/Sort.svelte'
  import Placeholder from '$lib/components/ui/Placeholder.svelte'
  import CommunityItem from '$lib/components/lemmy/community/CommunityItem.svelte'
  import Location from '$lib/components/lemmy/dropdowns/Location.svelte'
  import { t } from '$lib/translations.js'
  import Header from '$lib/components/ui/layout/pages/Header.svelte'

  export let data

  let search = data.query || ''
  let instance = ''
</script>

<svelte:head>
  <title>{$t('routes.communities')}</title>
</svelte:head>

<Header pageHeader class="justify-between">
  <span>{$t('routes.communities')}</span>
  <Popover
    openOnHover
    class="!inline-flex"
    targetClass="inline"
    placement="bottom"
  >
    <Icon
      src={InformationCircle}
      size="20"
      mini
      slot="target"
      class="!inline"
    />
  </Popover>

  <form
    on:submit|preventDefault={() => searchParam($page.url, 'q', search, 'page')}
    class="flex gap-2 flex-row items-center"
    slot="extended"
  >
    <TextInput
      bind:value={search}
      aria-label={$t('routes.search.query')}
      size="md"
      class="flex-1"
    />
    <Button
      submit
      color="secondary"
      size="custom"
      class="self-end"
      style="width: 38px; height: 38px;"
      title="Search"
    >
      <Icon src={MagnifyingGlass} size="16" mini />
    </Button>
  </form>
</Header>
<div class="flex flex-row flex-wrap gap-4 mt-4 items-center">
  <Location selected={data.type} />
  <Sort selected={data.sort} />
</div>
<ul class="flex flex-col divide-y divide-slate-200 dark:divide-zinc-800">
  {#if data.communities.length == 0}
    <Placeholder
      icon={QuestionMarkCircle}
      title={$t('routes.search.noResults.title')}
      description={$t('routes.search.noResults.description')}
    />
  {/if}
  {#each data.communities as community}
    <CommunityItem {community} />
  {/each}
</ul>
{#if data.communities.length > 0 && data.communities.length >= 40}
  <div class="mt-2 w-full">
    <Pageination
      page={Number($page.url.searchParams.get('page')) || 1}
      on:change={(p) => searchParam($page.url, 'page', p.detail.toString())}
    />
  </div>
{/if}
